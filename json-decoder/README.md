# json-decoder
A simple JSON decoder for stringified JSON.

Check out the documentation [here](https://docs.python.org/3/library/json.html). Original source code is available [here](https://github.com/python/cpython/blob/3.14/Lib/json/__init__.py).

## Project structure
```markdown
json-decoder
├── buggy_json
├── json_decoder_stv.py
├── logs
├── .python-version
├── pyproject.toml
├── README.md
├── requirements.txt
└── uv.lock
```
- **buggy_json**: Contains the target subject that the fuzzer executes and mutates inputs against. This is the program under test where crashes or unexpected behavior are expected to occur.
- **bin**: This directory contains the binary subject to run the fuzzer on.
- **json_decoder_stv.py**: Entrypoint for the fuzzer.
- **logs**: Contains unique bug counts and their tracebacks.
- **.python-version**: Contains the recommended version of python to run.
- **pyproject.toml**: Defines the project metadata and Python tooling configuration, including dependencies, build system settings, and formatting/linting rules used by the fuzzer.
- **README.md**: Provides an overview of the project, including setup instructions, usage details, and a high-level explanation of how the fuzzer works.
- **uv.lock**: Lockfile generated by `uv` that pins exact dependency versions to ensure reproducible environments across different machines.
- **requirements.txt**: Lists the Python package dependencies required to run the fuzzer

If you want, I can also rewrite this as a polished README section or align it with a specific fuzzing framework’s conventions.

## Input structure
The following materials describe the standard specifications for each supported format. Use them as a reference to understand what valid input should look like:
* `JSON`: [RFC 8259](https://datatracker.ietf.org/doc/html/rfc8259)

Inputs in the below structure are accepted for the following formats:

* `'["foo", {"bar":["baz", null, 1.0, 2]}]'`
* `'{"__complex__": true, "real": 1, "imag": 2}'`
* `'{"json":"obj"}'`

## Output structure

Without bugs
```bash
$ uv run json_decoder_stv.py --str-json '{"json": "obj"}' --show-coverage
Output decoded data: {'json': 'obj'} of type <class 'dict'>
No bugs found. Skipping CSV creation
Saved bug count report and tracebacks for the bugs encountered!
Final bug count: defaultdict(<class 'int'>, {})

============================================================
COVERAGE REPORT (ACCUMULATED)
============================================================
Name                        Stmts   Miss Branch BrPart  Cover   Missing
-----------------------------------------------------------------------
buggy_json/__init__.py         47     43     38      3     8%   43-86, 123-129, 135-147
buggy_json/decoder_stv.py     237    187     78     13    20%   3-126, 142, 146->150, 152-188, 193-199, 206, 213-226, 235-237, 241->248, 244-246, 250-251, 256-259, 264-273, 276-277, 280, 283-402, 410, 413, 424-425
buggy_json/scanner_stv.py      53     44     22      1    16%   3-28, 31-32, 39-65, 71-73
-----------------------------------------------------------------------
TOTAL                         337    274    138     17    17%

============================================================
detailed coverage summary
============================================================
line coverage     : 18.69% (63/337)
branch coverage   : 13.77% (19/138)
combined coverage : 17.26%
============================================================

============================================================
uncovered branches
============================================================

file: /home/dischad/Documents/GitHub/json-decoder/buggy_json/__init__.py
missing_branches 43-86, 123-129, 135-147
 line 43: missing branch to line 86
 line 123: missing branch to line 129
 line 135: missing branch to line 147

file: /home/dischad/Documents/GitHub/json-decoder/buggy_json/decoder_stv.py
missing_branches 3-126, 142, 152-188, 193-199, 206, 213-226, 235-237, 244-246, 250-251, 256-259, 264-273, 276-277, 280, 283-402, 410, 413, 424-425
 line 3: missing branch to line 126
 line 142: missing branch to exit
 line 152: missing branch to line 188
 line 193: missing branch to line 199
 line 206: missing branch to exit
 line 213: missing branch to line 226
 line 235: missing branch to line 237
 line 244: missing branch to line 246
 line 250: missing branch to line 251
 line 256: missing branch to line 259
 line 264: missing branch to line 273
 line 276: missing branch to line 277
 line 280: missing branch to exit
 line 283: missing branch to line 402
 line 410: missing branch to exit
 line 413: missing branch to exit
 line 424: missing branch to line 425

file: /home/dischad/Documents/GitHub/json-decoder/buggy_json/scanner_stv.py
missing_branches 3-28, 31-32, 39-65, 71-73
 line 3: missing branch to line 28
 line 31: missing branch to line 32
 line 39: missing branch to line 65
 line 71: missing branch to line 73
Coverage data saved to: .coverage_buggy_json
```

With bugs
```bash
$ uv run json_decoder_stv.py --str-json '{"a":' --show-coverage
Loading existing coverage data from .coverage_buggy_json

An invalidity bug has been triggered: Expecting value: line 1 column 6 (char 5)
============================================================
TRACEBACK
============================================================
Traceback (most recent call last):
  File "/home/dischad/Documents/GitHub/json-decoder/json_decoder_stv.py", line 263, in <module>
    data = loads(args.str_json)
          ^^^^^^^^^^^^^^^^^^^^
  File "/home/dischad/Documents/GitHub/json-decoder/buggy_json/__init__.py", line 134, in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dischad/Documents/GitHub/json-decoder/buggy_json/decoder_stv.py", line 407, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dischad/Documents/GitHub/json-decoder/buggy_json/decoder_stv.py", line 423, in raw_decode
    obj, end = self.scan_once(s, idx)
               ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dischad/Documents/GitHub/json-decoder/buggy_json/scanner_stv.py", line 67, in scan_once
    return _scan_once(string, idx)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dischad/Documents/GitHub/json-decoder/buggy_json/scanner_stv.py", line 37, in _scan_once
    return parse_object((string, idx + 1), strict,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/dischad/Documents/GitHub/json-decoder/buggy_json/decoder_stv.py", line 251, in JSONObject
    raise JSONDecodeError("Expecting value", s, err.value) from None
buggy_json.decoder_stv.JSONDecodeError: Expecting value: line 1 column 6 (char 5)
============================================================
Saved bug count report and tracebacks for the bugs encountered!
Final bug count: defaultdict(<class 'int'>, {('invalidity', <class 'buggy_json.decoder_stv.JSONDecodeError'>, 'Expecting value: line 1 column 6 (char 5)', '/home/dischad/Documents/GitHub/json-decoder/buggy_json/decoder_stv.py', 251): 1})

============================================================
COVERAGE REPORT (ACCUMULATED)
============================================================
Name                        Stmts   Miss Branch BrPart  Cover   Missing
-----------------------------------------------------------------------
buggy_json/__init__.py         47     43     38      3     8%   43-86, 123-129, 135-147
buggy_json/decoder_stv.py     237    173     78     13    24%   3-79, 90-126, 142, 146->150, 152-188, 193-199, 206, 213-226, 235-237, 241->248, 244, 256-259, 264-273, 276-277, 280, 283-402, 410, 413, 425
buggy_json/scanner_stv.py      53     42     22      1    19%   3-28, 39-65, 71-73
-----------------------------------------------------------------------
TOTAL                         337    258    138     17    21%

============================================================
detailed coverage summary
============================================================
line coverage     : 23.44% (79/337)
branch coverage   : 13.77% (19/138)
combined coverage : 20.63%
============================================================

============================================================
uncovered branches
============================================================

file: /home/dischad/Documents/GitHub/json-decoder/buggy_json/__init__.py
missing_branches 43-86, 123-129, 135-147
 line 43: missing branch to line 86
 line 123: missing branch to line 129
 line 135: missing branch to line 147

file: /home/dischad/Documents/GitHub/json-decoder/buggy_json/decoder_stv.py
missing_branches 3-79, 90-126, 142, 152-188, 193-199, 206, 213-226, 235-237, 244, 256-259, 264-273, 276-277, 280, 283-402, 410, 413, 425
 line 3: missing branch to line 79
 line 90: missing branch to line 126
 line 142: missing branch to exit
 line 152: missing branch to line 188
 line 193: missing branch to line 199
 line 206: missing branch to exit
 line 213: missing branch to line 226
 line 235: missing branch to line 237
 line 244: missing branch to exit
 line 256: missing branch to line 259
 line 264: missing branch to line 273
 line 276: missing branch to line 277
 line 280: missing branch to exit
 line 283: missing branch to line 402
 line 410: missing branch to exit
 line 413: missing branch to exit
 line 425: missing branch to exit

file: /home/dischad/Documents/GitHub/json-decoder/buggy_json/scanner_stv.py
missing_branches 3-28, 39-65, 71-73
 line 3: missing branch to line 28
 line 39: missing branch to line 65
 line 71: missing branch to line 73
Coverage data saved to: .coverage_buggy_json
```

## Setup instructions

This project supports two ways to set up the Python environment: using [**uv**](https://docs.astral.sh/uv/getting-started/installation/) (recommended if you already use it) or using **standard Python tooling**.

### Option 1: Using `uv` (with lockfile)

If you have `uv` installed, you can create a fully reproducible environment using the existing lockfile.

1. Ensure you are using the recommended Python version:

   ```bash
   cat .python-version
   ```

2. Create the virtual environment and install dependencies:

   ```bash
   uv sync
   ```

This will create a virtual environment and install the exact dependency versions specified in `uv.lock`.

---

### Option 2: Using standard Python (`venv` + `pip`)

If you prefer plain Python tooling, create a virtual environment and install dependencies from `requirements.txt`.

1. Ensure you are using the recommended Python version:

   ```bash
   cat .python-version
   ```

2. Create and activate a virtual environment:

   ```bash
   python -m venv .venv
   source .venv/bin/activate  # Linux / macOS
   # .venv\Scripts\activate   # Windows
   ```

3. Install dependencies:

   ```bash
   pip install -r requirements.txt
   ```

---

## Instructions to run
Run the binary file in the terminal as shown:
```bash
$ uv run json_decoder_stv.py [-h] [--str-json STR_JSON] [--coverage-file COVERAGE_FILE] [--show-coverage] [--reset-coverage] [--coverage-summary]
```
Consult the documentation with the `--help` flag if you are in doubt.

## List of removed functions
* `load`
* `dump`
* `dumps`
